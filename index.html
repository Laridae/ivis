<!DOCTYPE html>
<head>
  <link rel="stylesheet" type="text/css" href="magic.css">
  <script src="logic.js"></script>


<meta charset="utf-8">

<style>
  .links line {
  stroke: #999;
  stroke-opacity: 0.6;
}
  .nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}
</style>

</head>

<body>

<div id="questions" height=360px width=100%>

    <div id="question0" class="question">
      <h2>PVälkommen, </h2>
      Det här är den modifierade valkompassen. Frågorna du får här är desamma, men de 25 visas nu i en directed force graph 
      här under. De olika frågorna dras närmare de partierna som håller med dem, och längre ifrån de partier som är emot dem.  
      <br />
      <br />
      1. Du kan klicka och dra i frågorna för att hitta en nya jämviktslägen. Ökningen av Rut kommer t ex. alltid ligga närmare
      alliansen, och Förbud mot vinster i välfärden hör till vänstern - men de måste inte ligga exakt där de ligger. 
      <br />
      2. Du kan alltid hålla musen över en node för att se vilken fråga den motsvarar.
      
  </div>
  
  <div id="question1" class="question">
      <h2>Klimatpolitiken ska överordnas annan politik</h2>
      Syftet med den nya klimatlagen från 1 januari 2018 är att främja en framtida långsiktig och stabil politik för klimat och miljö. 
      Tanken är att framtida riksdagar och regeringar ska tvingas ta hänsyn till, och i praktiken överordna, klimatet när andra politiska 
      beslut ska fattas.
      <p><b>Argument för:</b>
      Den nya klimatpolitiken är den viktigaste reform den nuvarande generationens politiker kommer att ge kommande generationer. Sverige 
      kan nu bli ett av världens första fossilfria välfärdsländer. Omställningen kommer att ge vårt land bättre hälsa, fler jobb och ökad 
      konkurrenskraft.
    <p/>
    <p>
      <b>Argument mot:</b>
      Klimatpolitikens upphöjande till lag ökar inte möjligheten att bedriva effektivt klimatpolitiskt arbete. Framtida riksdagsmajoriteter 
      kan upphäva lagen. Klimatfrågor är sammanlänkade med övriga samhällsfrågor och miljöpolitik bör beaktas i samklang med ekonomi och 
      sociala frågor. Dyra utsläppsminskningar i Sverige minskar inte utsläppen globalt, däremot skadas svensk tillväxt.
    </p>
  </div>
  <div id="question2" class="question" >
      <h2>Den obligatoriska värnplikten ska återinföras</h2>
      Den allmänna värnplikten avskaffades 2010 med påpekandet att militär värnplikt kan återinföras vid krig. 2017 infördes en 
      mönstringsplikt, men bara 13 000 personer kommer årligen att kallas till mönstring.
      <br />
      <br />
    <b>Argument för</b>
    
      Obligatorisk militär värnplikt för män och kvinnor garanterar ett folkligt inflytande över militären, samtidigt som Försvarsmakten klarar sin personalförsörjning. Försvaret är till för att garantera vårt nationella självbestämmande och därför bör Sverige ha en folkligt förankrad försvarsmakt med både fasta och kontraktsanställda.
      <p><b>Argument mot</b>
      Den obligatoriska militära värnplikten är ett system som överlevt sig självt. Deltagande i militära verksamheter ska bygga på frivillighet. Modern krigföring kräver inte längre gigantiska folkliga arméer utan snarare kvalitativt högteknologiska system med experter och professionella soldater.
      </p>
  </div>
  <div id="question3" class="question">
      <h2>Fler pappamånader ska införas</h2>
      Endast en fjärdedel av föräldradagarna tas ut av män. Majoriteten män tar bara ut de tre öronmärkta pappamånaderna. Därför finns förslag om att utöka antalet månader, som föräldrarna inte får överlåta, från tre till fem.
    <p>
    <b>Argument för</b>
      Föräldraförsäkringen har en nyckelroll för jämställdheten – därför är dagens tre pappamånader inte nog. Barn behöver båda föräldrarna och därför ska föräldraförsäkringen delas mer jämlikt mellan föräldrarna.
    </p>
    <b>Argument mot</b>
      Staten ska inte lägga sig i hur föräldrar använder föräldraförsäkringen. Föräldrarna är bäst lämpade att avgöra det. Det behövs ett flexiblare synsätt på föräldraförsäkringen, en del av försäkringen bör exempelvis kunna användas senare när barnen är äldre.

  </div>
  <div id="question4" class="question">
      <h2>Permanent uppehållstillstånd ska vara huvudregel i flyktingpolitiken</h2>
      En utländsk medborgare med permanent uppehållstillstånd har rätt att bo, studera och arbeta i Sverige, liksom att åka in i och ut ur landet. Möjlighet finns också att ta hit sin familj.
      <p>
      Argument för: 
      Flyktingar som kommer till Sverige för att söka skydd undan krig, våld och förföljelse ska möta en värdig integrationsprocess – inte hot om returresa. Med tillfälliga uppehållstillstånd ökar rättsosäkerheten och risken för enskilda att utnyttjas.
      </p>  
      <p>Argument mot
      Vetskapen att Sverige inte delar ut permanenta uppehållstillstånd har minskat trycket mot våra gränser. Fler på flykt väljer andra europeiska länder. Tillfälliga uppehållstillstånd ger flyktingar incitament att anstränga sig än mer i integrationsprocessen för att få stanna.
      </p>  
    
  </div>
  <div id="question5" class="question">
        <h2>Lägre ingångslöner för ungdomar ska införas</h2>
      Forskningen kan inte entydigt visa att lägre ingångslöner leder till fler jobb för unga, men mycket tyder på det. Skillnaderna är dock stora mellan exempelvis industrin och de sektorer där många unga arbetar, till exempel detaljhandel, hotell- och restaurangjobb.
      Argument för
      Lägre ingångslöner leder till fler jobb. Med ett första lågbetalt jobb ges möjlighet att höja lönen genom att visa framfötterna. Statistik visar att klättringen i lönetrappan kan vara snabb. Alternativet, att stå utanför arbetsmarknaden, är förödande för unga människor.
      Argument mot
      Lägre ingångslöner leder automatiskt inte till fler jobb för unga. Det svårt att leva på en låg lön – särskilt när den består över tiden. Det finns ingen garanti om snabb löneökning ens för den som är duktig. Låga ingångslöner riskerar snarare att pressa ned lönerna generellt.
  
  </div>
  <div id="question6" class="question">
      <h2>Sverige ska söka medlemskap i Nato</h2>
      Medlemsstaterna i Nato ska försvara varandra mot yttre fiender. Merparten av Europas stater är medlemmar. Nato är världens viktigaste militära sammanslutning vars budget utgör 69 procent av världens samlade försvarsutgifter
      Argument för
      Sverige har redan nu ett nära samarbete med Nato, vars syfte är att värna om demokratin. Därför är ett medlemskap naturligt. Ett medlemskap är nödvändigt för att kunna påverka utvecklingen inom alliansen.
      Argument mot
      Nato baserar sin säkerhet på kärnvapenavskräckning. Men Nato saknar en avgörande säkerhetspolitiska instrument som diplomati, handel och konfliktförebyggande civila insatser. Sverige kan som medlem dras in i andra länders konflikter.

  </div>
  <div id="question7" class="question">
        <h2>Sverige ska satsa på snabbtåg</h2>
      Snabbtåg mellan Stockholm och Göteborg och mellan Stockholm och Malmö kortar restiderna. Satsningen beräknas kosta minst 230 miljarder kronor.
      Argument för
      Snabbtåg är bra för miljön och förkortar restiden avsevärt. Med snabbanor ökar möjligheterna för mer godstrafik på nuvarande spår. Ett hårt slitet järnvägsnät måste förnyas.
      Argument mot
      Snabbtåg är dyrt. Ett billigare alternativ är att öka kapaciteten för regionaltåg och godståg. Ett höghastighetsnät har i förhållande till kostnaderna små effekter på utsläpp av klimatgaser.
  
  </div>
  <div id="question8" class="question">
        <h2>Ett bidragstak ska införas</h2>
      För den som kan arbeta, men inte gör det, föreslås en övre gräns för försörjningsstöd och etableringsersättning. Bidragstaket blir 75 procent av lägstalön och bostadsbidrag– exklusive barnbidrag och underhållsstöd. Syftet är att stimulera till arbete.
      Argument för
      Olika ersättningar staplade på varandra kan leda till så högt sammanlagt bidrag att det blir olönsamt att jobba. Ett bidragstak hjälper människor att inte fastna i bidragsberoende och ger incitament att ta sig in i arbetslivet.
      Argument mot
      I ett solidariskt samhälle har alla enskilda medborgare gemensamt ansvar för människor som av olika skäl inte klarar sin försörjning. Samhällets skyddsnät ska värnas, annars undergrävs solidariteten och därmed den svenska modellen.
    
  </div>
  <div id="question9" class="question">
      <h2>Sex timmars arbetsdag ska införas</h2>
      Arbetslivet förändras i och med teknikutveckling och automatisering. En del jobb kommer att försvinna och nya tillkommer. Förslag finns att dela på jobben genom att sänka arbetstiden till sex timmar om dagen med bibehållen lön.

      <p><b>Argument för</b>
      Sammanhållningen i samhället hotas när jobb försvinner och fler ställs utanför arbetsmarknaden. Utvecklingen ska mötas med sänkt arbetstid och att vi delar på jobben. Det ger ett arbetsliv med ett mänskligare tempo, ett friskare och mer välmående Sverige.
      </p>
      <p><b>Argument mot</b>
      Att jobba mindre och kortare tid är redan en möjlighet för den enskilde. Men det är inte rimligt att jobba sex timmar och få betalt för åtta. Sänkt arbetstid ger ett stressigare arbetsliv.
      </p>
  </div>
  <div id="question10" class="question">
    <h2>Pensionsåldern ska höjas</h2>
      Förslaget handlar om att höja den nedre gränsen för pension från 61 till 63 år. Samtidigt ska den övre gränsen höjas från 67 till 69 år. Det innebär att alla måste jobba minst två år längre än i dag innan pension. Samtidigt ska den som vill kunna jobba till 69 mot 67 i dag.
      Argument för
      Höjningen av pensionsåldern är en naturlig följd av att vi lever längre och dessutom har fler friska år. Det mest effektiva sättet att få människor att jobba längre är att höja den lagstadgade åldersgränsen.
      Argument mot
      Många som har hårda jobb orkar inte ens idag stanna på arbetsmarknaden fram till pensionering. Det är bättre att de äldre lämnar plats för alla unga som saknar jobb. Det är redan nu svårt för äldre att få nya jobb eftersom få arbetsgivare vill anställa någon med kort tid kvar på arbetsmarknaden.
  
  </div>
  <div id="question11" class="question">
        
    <h2>Skatten på pension ska vara samma som på lön</h2>
      <p>Skatten för pensionärer har sänkts, men fortfarande betalar ungefär hälften av pensionärerna procentuellt mer i skatt än en löntagare. Detta beror på jobbavdraget vars syfte är att fler ska välja jobb före bidrag samtidigt som fler i pensionsålder ska stimuleras att fortsätta arbeta.</p>
      <h4>Argument för</h4>
      Antalet fattiga pensionärer i Sverige beräknas till ungefär 250 000. Pension är uppskjuten lön. Högre beskattning på redan intjänade pengar är orättvist. Pensionärsskatten kan skada samhällsgemenskapen mellan generationer.
      <h4>Argument mot</h4>
      Jobbskatteavdraget har stimulerat fler att jobba mer och längre. Det har svensk ekonomi mått bra av, vilket också gynnar pensionärer. Den som arbetar har merkostnader för lunch, resor, kläder och annat.

  </div>
  <div id="question12" class="question">
        <h2>Arbetsförmedlingen ska läggas ner</h2>
      Arbetsförmedlingens huvuduppdrag är att sammanföra arbetssökande med arbetsgivare som söker arbetskraft. Arbetsförmedlingen ska också stödja och rusta personer som befinner sig långt från arbetsmarknaden.
      Argument för
      Statens miljardsatsningar är bortkastade. Arbetsförmedlingen klarar inte sitt uppdrag. En ny myndighet bör få ansvar för uppföljning på arbetsmarknaden. Matchningen av arbetssökande bör skötas av bemannings- och rekryteringsföretag.
      Argument mot
      Mellan 100 000 och 150 000 är arbetssökande i Sverige. Nästan alla är nyanlända. Så många som möjligt av dessa måste så snabbt som möjligt få jobb. Det vore direkt ansvarslöst att lägga ner en erfaren och kompetent arbetsförmedling i detta läge.
  

  </div>
  <div id="question13" class="question">
      <h2>Tandvård ska subventioneras på samma sätt som sjukvård</h2>
      Förslaget handlar om att jämställa tandvård med övrig sjukvård. Tanken är att tandvården huvudsakligen ska finansieras via skattesystemet, avgifterna ska vara låga och patienterna ska omfattas av högkostnadsskydd liksom övrig sjukvård.
      Argument för
      Kostnaderna för tandvård är så höga att många tvingas avstå från vård, vilket leder till allvarliga tandproblem och höga kostnader för individ och samhälle. Dålig tandhälsa försämrar enskildas livskvalitet och är en klassmarkör.
      Argument mot
      Kostnaden för en tandvårdsreform som jämställer tandvård med övrig sjukvård har uppskattats till omkring 20 miljarder. Denna kostnad är alltför hög.   
    
   </div>
  <div id="question14" class="question">
          <h2>Sverige ska lämna EU</h2>
      Allt sedan Sverige blev medlem i EU 1995 har några partier krävt att Sverige ska lämna EU. Samtidigt har andra partier som tidigare var emot medlemskapet kommit att acceptera det.
      Argument för
      Storbritanniens folkomröstning har visat att det är möjligt att lämna EU. Vi behöver inte ett odemokratiskt supermaktsbygge utan mer nationellt självbestämmande. Det militära samarbetet inom EU äventyrar just nu svensk neutralitetspolitik.
      Argument mot
      Sverige gick med i EU efter att folket sagt ja i en folkomröstning 1994. En klar majoritet anser fortfarande att Sverige ska vara med i EU. Som EU-medlem har vi möjligheter att säkra en trygg utveckling. Om vi står utanför EU kommer andra att bestämma vår framtid.

  </div>
  <div id="question15" class="question">
      <h2>Ensamkommande barn ska få allmän amnesti</h2>
      Allmän amnesti för ensamkommande barn och ungdomar, som varit i Sverige i minst ett år, föreslås. Amnesty, FN och Afghanistankommittén bedömer läget i Afghanistan, där de flesta kommer ifrån, som osäkert och att det är riskfyllt att återvända.
      Argument för
      Våldet i Afghanistan är omfattande. En allmän amnesti ger barn möjlighet att börja nya liv i Sverige. Många unga nyanlända har levt så länge som flyktingar att de saknar släktingar att knyta an till eller skickas tillbaka till.
      Argument mot
      Många ensamkommande ljuger om sin ålder. Enligt Migrationsverkets bedömning är många provinser i Afghanistan tillräckligt säkra för att motivera ett avslag på de ensamkommandes asylansökan. Sverige bör i stället satsa på utvidgad arbetskraftsinvandring. De som saknar asylskäl kan få stanna under förutsättning att de kan försörja sig.

  </div>
  <div id="question16" class="question">
     
    <h2>Niqab ska förbjudas i skolan</h2>
      Niqab är en slöja som täcker hela ansiktet utom ögonen. I Norge, Belgien och Frankrike är det förbjudet för såväl lärare som elever att bära niqab i skolan.
      Argument för
      Elever och lärare måste kunna se varandras ansikten, annars försvåras möjligheterna till inlärning. Niqab hör inte hemma i det svenska samhället eftersom det är ett uttryck för kvinnoförtryck.
      Argument mot
      Det är fel att lagstifta om människors klädsel. Var och en ska i religionsfrihetens namn ha rätt att klä sig enligt sin religiösa övertygelse. För de muslimska kvinnor som bär niqab bidrar det till att upprätthålla deras status och värdighet.

  </div>
  <div id="question17" class="question">
    <h2>Bensinskatten ska höjas</h2>
      Sedan 1995 tas en koldioxidskatt plus en energiskatt ut på bensin. Begreppet bensinskatt syftar i dagligt tal på de två skatterna tillsammans. Eftersom det också betalas moms på bensin utgör den totala skatten strax under 60 procent av bensinpriset.
      Argument för
      Att bekämpa klimathotet är den viktigaste uppgiften i dag. Sverige har bland Europas mest bränsletörstiga bilar. I framtiden måste vi sluta slösa med bensinen, satsa på modernare och bensinsnålare bilar och bygga ut kollektivtrafiken.
      Argument mot
      Höjd skatt på bensin slår direkt mot vanligt folk. Värst drabbas människor och företag i glesbygden, där behovet av bilen är störst. Kraftigt höjda koldioxid- och energiskatter hotar tillväxten och jobben.
  
    

  </div>
  <div id="question18" class="question">
         <h2>Det är rätt att införa en flygskatt</h2>
      Flygskatten ska värna om miljön. Den medför att varje flygresa blir dyrare. En resa inom Sverige och EU stiger med 60 kronor, medan långflygningen kan bli 400 kronor dyrare.
      Argument för
      Alla kommunikationer, flyget liksom bilismen, måste ta större ansvar för miljön och klimatpåverkan. Att ta ansvar innebär att betala för sina miljöpåverkande utsläpp.
      Argument mot
      En flygskatt har inte någon större positiv effekt på miljön. Däremot blir den en avgift på resa, vilket drabbar vissa regioner. Därmed hotas jobb, tillgänglighet, konkurrenskraft och tillväxt.

  
    
  </div>
  <div id="question19" class="question">
        <h2>Eget bruk av narkotika ska tillåtas</h2>
      En hård attityd mot narkotika och narkotikaanvändning utmärker svensk politik. Spår av narkotika i blodet kan ge upp till sex månaders fängelse.
      Argument för
      Sverige redovisar hög dödlighet på grund av narkotikaanvändning. Legalisering skulle leda till att fler söker hjälp och vård. Nolltoleransen fungerar inte.
      Argument mot
      Nolltolerans fungerar. Färre i Sverige än i jämförbara länder använder preparat som kokain, cannabis och ecstasy. Missbruket skulle öka vid legalisering av eget bruk.

  </div>
  <div id="question20" class="question">
      <h2>Inga fler religiösa friskolor ska tillåtas</h2>
      I Sverige har runt 1 procent av skolorna en huvudman med religiös anknytning. Det finns förslag om att skärpa reglerna för dessa 70 religiösa grund- och gymnasieskolor samt att inga fler religiösa friskolor ska få starta.
      Argument för
      En huvudtanke med svensk skola är integrering - elever från olika miljöer ska mötas. Skolan ska inte sära på barn och föräldrar och organisationer ska inte kunna isolera barn från samhället. Därför ska inga fler religiösa skolor få starta.
      Argument mot
      De få religiösa friskolorna uppfyller kraven i skollagen. De bedriver en bra verksamhet utifrån goda värderingar. Inte sällan fungerar dessa skolor som andningshål för troende elever och föräldrar.

    
  </div>
  <div id="question21" class="question">
    <h2>Tiggeri ska förbjudas</h2>
      Flera europeiska länder, till exempel Danmark, Norge, Nederländerna och Storbritannien, har förbud mot gatutiggeri. Det finns flera liknande förslag om förbud mot tiggeri i svensk debatt.
      <p><b>Argument för</b>
      Ett tiggeriförbud motverkar risken för livslångt tiggeri och permanent fattigdom. Ett förbud ökar trycket på reformer i tiggarnas hemländer.
      </p>
      <b>Argument mot</b>
      Att förbjuda tiggeri är att angripa ett symptom i stället för problemets rot. De som tigger i Sverige gör det för att de lever under miserabla förhållanden i sina hemländer.
      </div>
  
  <div id="question22" class="question">
      <h2>Vinster i välfärden ska förbjudas</h2>
      Inom välfärdens kärna - skola, vård och omsorg – ska den politiska kontrollen garantera medborgarnas likvärdighet. Med fler privata aktörer inom sektorn har debatt uppstått om rimligheten med vinster på skattefinansierad verksamhet.
      Argument för
      Skattemedel avsedda för skola och sjukvård ska användas för att garantera likvärdig utbildning och god vård för alla medborgare. När privata företag jagar vinst ökar risken för sämre kvalitét och ojämlika prioriteringar.
      Argument mot
      Privata företag inom vård och skola går med vinst för att de är välskötta, ger god service och har bra personal. Ingen protesterar mot privata läkemedelsföretag eller att privata företag bygger skolor.
  </div>
  
  <div id="question23" class="question">
      <h2>Polisen ska få bättre tillgång till kameraövervakning</h2>
      Polisens användning av kameraövervakning ökar. För fem år sedan fanns ett tiotal fasta kameror. I dag är antalet runt 170 och många finns i problemförorter. Nationellt satsar polisen på ett gemensamt och enhetligt övervakningssystem.
      Argument för
      Kameror för övervakning är ett viktigt komplement för att trygga människors vardagsmiljöer liksom för att klara brottsutredningar. Polisens arbete underlättas om tillstånd inte behövs för att kameraövervaka utsatta miljöer.
      Argument mot
      Enligt forskningen har kameror för övervakning inte någon större påverkan på brottsligheten. Däremot kan kameror snarare skapa falsk trygghet. Ett samhälle där storebror ser dig är inte önskvärt.
  </div>
  
  <div id="question24" class="question">
      <h2>Varje form av stöd till terrorism ska kriminaliseras</h2>
      Det är straffbart i Sverige att stödja terrorism ekonomiskt. Frågan om att kriminalisera medlemskap eller ett mer allmänt stöd till terrororganisationer har diskuterats. Nu finns förslag att bredda lagen även för andra typer av stöd och deltagande. En modell finns i Norge där det är förbjudet att vara med i en terrororganisation.
      <p><b>Argument för</b>
      Det finns en lucka i lagen som gäller människor som ger allmänt stöd eller som agerar aktivt för terrorism utan att det kan kopplas till ett specifikt brott. Denna lucka måste täppas till så att det blir lättare att förebygga terrorbrott.
      </p>
      <p><b>Argument mot</b>
      I en demokrati måste människor kunna samlas för att diskutera och demonstrera och ha rätt att bilda organisationer. Föreningsfriheten skyddas av FN och i Europakonventionen, därför kan ett allmänt förbud mot terrorism krocka med grundlagen.
      </p>
    
  </div>
  <div id="question25" class="question">
    <h2>Rut-avdraget ska tredubblas</h2>
      Rut-avdraget möjliggör skatteavdrag för tjänster i hemmet. Ett förslag handlar om att utvidga rut jämfört med i dag. Istället för 25 000 kronor per år föreslås 70 000 i skatteavdrag för arbetskostnad. Avdraget ska enligt förslaget riktas tydligare mot äldre.
      Argument för
      Rut skapar nya jobb, i första hand för dem som har svårt att ta sig in på arbetsmarknaden. Det gynnar tillväxten. Samtidigt är rut till stor hjälp för människor som behöver stöd i hemmet – allt från barnfamiljer till pensionärer.
      Argument mot
      Rut-avdraget gynnar välbeställda. De tio rikaste procenten av befolkningen köper närmare hälften av tjänsterna. Staten ska inte subventionera rikas köp av hushållstjänster. Hjälp till äldre ska grundas på behov, inte på ekonomisk status.

  </div>
  <div id="question26" class="question">
      <h2>Du är färdig ~</h2>
      Ta ett ögonblick att undersöka grafen innan du går tillbaka och avslutar formuläret. 
  </div>
</div>
  

<div id="start_option">
    <div id="option">
        <input name="option0" 
               type="button" 
               value="Jag förstår!" 
               onclick="mission_start()"  />
    </div>
</div>
  
<div id="options">  
    <div id="option1" class="option">
        <input name="option1" 
               type="button" 
               value="Instämmer helt" 
               onclick="show_next_question()"  />
    </div>
    <div id="option2" class="option">
        <input name="option2" 
               type="button" 
               value="Instämmer delvis" 
               onclick="show_next_question2()" />
    </div>
    <div id="option3" class="option">
        <input name="option3" 
               type="button" 
               value="Delvis emot" 
               onclick="show_next_question3()" />
    </div>
    <div id="option4" class="option">
        <input name="option4" 
               type="button" 
               value="Helt emot" 
               onclick="show_next_question4()" />
    </div>
</div>
  
</body>

<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

var color = d3.scaleOrdinal(d3.schemeCategory20);

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }).distance(function(d) {return d.distance}))
    .force("charge", d3.forceManyBody(-1500))
    .force("center", d3.forceCenter(width / 2, height / 2));

d3.json("miserables.json", function(error, graph) {
  if (error) throw error;

  var link = svg.append("g")
      .attr("class", "links")
    .selectAll("line")
    .data(graph.links)
    .enter().append("line")
      .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

  var node = svg.append("g")
      .attr("class", "nodes")
    .selectAll("circle")
    .data(graph.nodes)
    .enter().append("circle")
      .attr("r", 8.2)
      .attr("fill", "gainsboro") 
      .attr("id", function(d) { return d.id; })
      .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));
  

  
  /* Ignore
  //Here we makes 9 special nodes, each being filled in with a .jpg instead.
  //it seems we need a svg pattern?
    var node = svg.append("g")
      .attr("class", "nodes")
    .data(graph.nodes.v)
    .enter().append("/ivis/v.jpg")
      .attr("fill", "/ivis/v.jpg") 
  */
  //https://github.com/Laridae/ivis/blob/master/v.jpg

  node.append("title")
      .text(function(d) { return d.id; });
  
  node.selectAll("#KD").enter()
      .append("pattern")
      //.attr("id", function(d) {return d.id})
      .attr("class", "svg-image")
      .attr("x", "0")
      .attr("y", "0")
      .attr("height", "1")
      .attr("width", "1")
      .append("image")
        .attr("x", "0")
        .attr("y", "0")
        .attr("height", "70px")
        .attr("width", "70px")
        .attr("xlink:href", "https://laridae.github.io/ivis/assets/kd.jpg")

  simulation
      .nodes(graph.nodes)
      .on("tick", ticked);

  simulation.force("link")
      .links(graph.links);
      // This ought reinitialize unique link.distance for each node. 
      /*
      .linkDistance(function (d) {
           return d.linkDistance;
     })
     */
     

  function ticked() {
    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  }
});

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

</script>
